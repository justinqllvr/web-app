<div class="row">
	<div class="col-md-4">
		<div class="city_pres">
			<div class="city_title">
				<h3>Les signalements à</h3>
				<h1 class="city_name"><%= @city.name %></h1>
			</div>
			<ul class="nav nav-pills">
			  <% Report.states.each do |key, value| %>
			    <li class="nav-item">
						<%= link_to t("report.state.#{key}"),
												city_path(@city, state: key),
												class: "nav-link b_city #{'active' if params[:state] == key}" %>
					</li>
			  <% end %>
			</ul>
		</div>
		<h1 class="mt-5 mb-5">Signalements triés par soutiens</h1>
		<% if @reports.any? %>
			<div class="row grid no-margin">
				<%= render @reports %>
			</div>
		<% end %>
	</div>
	<div class="col-md-8 macarte">
		<div id="map"></div>
		<script>
			function initMap() {
				var map = new google.maps.Map(document.getElementById('map'), {
					center: {lat: <%=@latitude%>, lng: <%=@longitude%>},
					zoom: 13
				});
				<% @city.reports.each do |report| %>
				var marker = new google.maps.Marker({
					position: new google.maps.LatLng(<%= report.latitude %>, <%= report.longitude %>),
				});
				marker.setMap(map);
				<% end %>
			}
		</script>
	</div>
</div>
<% if can? :manage, @city %>
	Hello admin
<% end %>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap"async defer></script>
<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
      var $grid = $('.grid').masonry({
        itemSelector: '.grid-item'
      });

      $grid.imagesLoaded().progress( function() {
        $grid.masonry('layout');
      });
  });
</script>
