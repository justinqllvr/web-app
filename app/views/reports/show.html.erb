<div class="container-fluid">
    <div class="row no-margin">
        <div class="col-md-6 mt-5 report-display-container">
            <div class="report-display-body" style="margin-top: 1rem!important">
                <h1 class="mt-3"><%= @report.title %></h1>
                <%= image_tag @report.picture.url(angle: :exif), class: 'img-fluid' %>
                <span class="badge badge-primary"><%= @report.likes.count %> soutiens</span>
                
                <p><%= @report.text %></p>
                <p class="text-muted" style="">Signal√© par <%= @report.user %> le <%= @report.created_at.strftime "%d/%m/%Y" %></p>
                <div class="d-flex" style="flex-direction: row;">
                    <% if current_user %>
                        <%= link_to 'Edit', edit_report_path(@report), class: 'btn btn-info' if @report.user == current_user || current_user.admin %>
                        <% existing_like = @report.likes.find { |like| like.user_id == current_user.id} %>
                        <% if existing_like %>
                        <%= button_to 'Je ne soutiens plus', report_like_path(@report, existing_like), method: :delete, class: 'btn btn-danger ' %>
                        <% else %>
                        <%= button_to 'Je soutiens', report_likes_path(@report), method: :post, class: 'btn btn-success ' %>
                        <% end %>
                    <% end %>
                </div>
                <% if can? :manage, @city %>
                    <div>YOOOOOOOOOOOOOOOOO</div>
                <% end %>
            </div>
        </div>
        <div class="d-flex col-md-6 mt-5 no-padding" style="margin-top: 0!important">
            <div class="map-report" id="map" style="height: 85vh; width: 100%;"></div>
            <script>
                function initMap() {
                    var map = new google.maps.Map(document.getElementById('map'), {
                        zoom: 13,
                    });
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(<%= @report.latitude %>, <%= @report.longitude %>),
                        url: '<%= report_path(@report) %>'
                    });
                    marker.setMap(map);
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function (position) {
                            var pos = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude
                            };
                            map.setCenter(pos);
                        });
                    } else {
                        // Browser doesn't support Geolocation
                        var pos = {
                            lat: <%= @latitude ? @latitude : 44.841713 %>,
                            lng: <%= @longitude ? @longitude : -0.569101 %>
                        };
                    }
                    map.setCenter(pos);
                }   
                // function initMap() {
                //     var map = new google.maps.Map(document.getElementById('map'), {
                //         zoom: 16,
                //         styles: [{
                //                 "featureType": "poi.attraction",
                //                 "stylers": [{
                //                     "visibility": "off"
                //                 }]
                //             },
                //             {
                //                 "featureType": "poi.business",
                //                 "stylers": [{
                //                     "visibility": "off"
                //                 }]
                //             },
                //             {
                //                 "featureType": "poi.place_of_worship",
                //                 "stylers": [{
                //                     "visibility": "simplified"
                //                 }]
                //             },
                //             {
                //                 "featureType": "poi.sports_complex",
                //                 "stylers": [{
                //                     "visibility": "off"
                //                 }]
                //             }
                //         ]
                //     });
                //     var marker = new google.maps.Marker({
                //         position: new google.maps.LatLng( < %= @report.latitude % > , < %= @report.longitude % > ),
                //     });
                //     marker.setMap(map);
                // }
            </script>
            <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
        </div>
    </div>
</div>